import re


def strip_newlines_from_html(html_string):
    # Define tags where we want to preserve newlines
    preserve_tags = ["pre", "textarea", "script", "style"]

    # Split the HTML into segments based on preserve tags
    segments = re.split(
        f'(<(?:{"|".join(preserve_tags)}).*?</(?:{"|".join(preserve_tags)})>)',
        html_string,
        flags=re.DOTALL | re.IGNORECASE,
    )

    # Process each segment
    for i in range(0, len(segments), 2):
        # Remove newlines from non-preserve segments
        segments[i] = re.sub(r"\s*\n\s*", " ", segments[i])

    # Join the segments back together
    return "".join(segments)


if __name__ == "__main__":
    test_str = '<!DOCTYPE html>\n<html>\n<head>\n    <title>Social Security Analysis for R Hall and R Munster</title>\n</head>\n<body>\n    <header>\n        <h1>Social Security Analysis for R Hall and R Munster</h1>\n    </header>\n    \n    <main>\n        <section>\n            <h2>1. Work History and Earnings Summary</h2>\n            <table>\n                <thead>\n                    <tr>\n                        <th>Individual</th>\n                        <th>Total Years Worked</th>\n                        <th>Total Lifetime Earnings</th>\n                        <th>Primary Insurance Amount (PIA)</th>\n                        <th>Average Annual Earnings</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <tr>\n                        <td>R Hall (Primary Beneficiary)</td>\n                        <td>1 year</td>\n                        <td>$50,000.00</td>\n                        <td>$390.60</td>\n                        <td>$50,000.00</td>\n                    </tr>\n                    <tr>\n                        <td>R Munster (Spouse)</td>\n                        <td>1 year</td>\n                        <td>$60,000.00</td>\n                        <td>$282.60</td>\n                        <td>$60,000.00</td>\n                    </tr>\n                </tbody>\n            </table>\n        </section>\n\n        <section>\n            <h2>2. Estimated Social Security Benefits Analysis</h2>\n            <p>Both R Hall and R Munster have limited work history, with only one year of earnings each. Their estimated Social Security benefits are as follows:</p>\n            <ul>\n                <li><strong>R Hall (Primary Beneficiary):</strong> At their full retirement age (FRA) of 67, R Hall\'s estimated monthly benefit is $390.60. This is calculated based on their total lifetime earnings and the average indexed monthly earnings (AIME). Since they have worked for only one year, their benefit amount is relatively low.</li>\n                <li><strong>R Munster (Spouse):</strong> Similarly, R Munster\'s FRA is also 67, and their estimated monthly benefit is $282.60. This amount is based on their sole year of earnings.</li>\n            </ul>\n\n            <h3>Spousal Benefits</h3>\n            <p>According to the Social Security Administration\'s rules on <a href="https://www.ssa.gov/planners/spouse/spouseben2.html">spousal benefits</a>, R Munster may be eligible for spousal benefits based on R Hall\'s work record. If R Munster\'s benefit based on their own work is less than half of R Hall\'s full retirement benefit, they can receive the difference to bring their benefit up to half of R Hall\'s amount. However, this is only applicable if R Munster starts claiming benefits at their full retirement age or later.</p>\n        </section>\n\n        <section>\n            <h2>3. Recommendations for Optimizing Benefits</h2>\n            <p>Given their limited work history, R Hall and R Munster should consider the following strategies to optimize their Social Security benefits:</p>\n            <ol>\n                <li><strong>Delay Claiming Benefits:</strong> Both individuals should consider delaying their benefit claims until their full retirement age or even longer. For each year they delay claiming benefits beyond their FRA, their benefit amount will increase by a certain percentage, known as the <a href="https://www.ssa.gov/planners/retire/delayret.html">delayed retirement credit</a>. This can result in a higher monthly benefit for life.</li>\n                <li><strong>Spousal Benefits Strategy:</strong> R Munster should carefully evaluate the timing of their benefit claim to maximize spousal benefits. If R Hall claims benefits at their FRA, R Munster can claim spousal benefits at their FRA while allowing their own benefit to continue growing until age 70. This strategy ensures that R Munster receives the highest possible benefit based on their own work record while also benefiting from spousal benefits.</li>\n                <li><strong>Explore Other Income Sources:</strong> Given their low total lifetime earnings, R Hall and R Munster might consider exploring other income sources or part-time work opportunities to supplement their Social Security benefits. This could help them maintain a more comfortable standard of living during retirement.</li>\n            </ol>\n        </section>\n\n        <section>\n            <h2>4. Insights Related to Dependents</h2>\n            <p>The couple has a child, Bill, who is disabled. According to the Social Security Administration\'s <a href="https://www.ssa.gov/pubs/EN-05-10086.pdf">rules on benefits for children</a>, a disabled child can receive benefits based on a parent\'s work record. Bill may be eligible for benefits until he reaches the age of 18 (or 19 if still attending primary or secondary school). If Bill\'s disability continues after that age, he may be eligible for continued benefits as an adult disabled child.</p>\n        </section>\n\n        <section>\n            <h2>5. Relevant Rules and References</h2>\n            <ul>\n                <li>Social Security Administration: <a href="https://www.ssa.gov/planners/retire/retirechart.html">Full Retirement Age and Delayed Retirement Credits</a></li>\n                <li>Social Security Administration: <a href="https://www.ssa.gov/planners/spouse/">Benefits for Spouses</a></li>\n                <li>Social Security Administration: <a href="https://www.ssa.gov/pubs/EN-05-10086.pdf">Benefits for Children with Disabilities</a></li>\n            </ul>\n        </section>\n    </main>\n</body>\n</html>'

    print(test_str)
    clean_str = strip_newlines_from_html(test_str)
    print(clean_str)
